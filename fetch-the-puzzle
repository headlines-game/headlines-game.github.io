const url = "https://headlines-game.github.io/testing.txt";
const xhr = new XMLHttpRequest();
xhr.open("GET", url, true);

xhr.onload = function () {
  if (xhr.status === 200) {
    const content = xhr.responseText;

    // Parse the JSON content into an array
    const jsonArray = JSON.parse(content);

    // Get the value of the scene variable "current_puzzle"
    const currentPuzzle = runtimeScene.getVariables().get("current_puzzle").getAsString();

    // Find the index of the object with the matching "id" property
    const arrayIndex = jsonArray.findIndex((obj) => obj.id === parseInt(currentPuzzle));

    if (arrayIndex >= 0 && arrayIndex < jsonArray.length) {
      // Access the object at the specified index
      const targetObject = jsonArray[arrayIndex];

      // Extract the desired properties from the target object
      const headline = targetObject.headline;
      const subheading = targetObject.subheading;
      const hint = targetObject.hint;

      // Assign the values to the corresponding GDevelop variables
      const myHeadline = runtimeScene.getVariables().get("headline");
      myHeadline.setString(headline);

      const mySubheading = runtimeScene.getVariables().get("subheading");
      mySubheading.setString(subheading);

      const myHint = runtimeScene.getVariables().get("hint");
      myHint.setString(hint);

      // Collect all unique letters from the headline
      const sanitizedString = headline.replace(/\s+/g, "").toUpperCase();
      // Remove duplicates and sort the characters
      const uniqueChars = [...new Set(sanitizedString)].sort();
      // Convert the array of unique characters back to a string
      const resultingString = uniqueChars.join("");
      console.log(resultingString); // Output: "ABCEFHLNORSTVXY"
      const myLetters = runtimeScene.getVariables().get("letters");
      myLetters.setString(resultingString);
    }
  }
};

xhr.send();
